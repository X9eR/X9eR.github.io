<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>AWS权限配置提权Challenge：It&#39;s a secret</title>
    <link href="/2025/01/07/It&#39;s%20a%20secret/"/>
    <url>/2025/01/07/It&#39;s%20a%20secret/</url>
    
    <content type="html"><![CDATA[<h1 id="Challenge：It’s-a-secret"><a href="#Challenge：It’s-a-secret" class="headerlink" title="Challenge：It’s a secret"></a>Challenge：It’s a secret</h1><p>此过程过于依赖hint，只作新手学习记录。</p><p>在非根管理账户xdg3中，有以下user:</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106162432985-1736152413513-2.png"></p><p>ctf-starting-user是我们要使用的起点用户，该账户具有以下权限策略：</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106162553268.png"></p><ul><li>SecurityAudit (AWS Managed)</li><li>CloudFox (Customer Managed)</li><li>its-a-secret (Customer Managed)</li></ul><p>前两个允许我们运行cloudfox，第三个允许用户ctf-starting-user获得flag。</p><p>第三个权限具体是：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;Version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2012-10-17&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;Statement&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;Sid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VisualEditor0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;Effect&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Allow&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;Action&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ssm:GetParameter&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;Resource&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arn:aws:ssm:us-west-2:248189904385:parameter/cloudfoxable/flag/its-a-secret&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>使用命令确定可以使用cloudfoxable的配置来获取ctf-starting-user的权限（来源于the first flag)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">aws --profile cloudfoxable sts get-caller-identity<br></code></pre></td></tr></table></figure><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106163050224.png"></p><p>之后运行命令，使用cloud fox工具列举账户中所有的secret</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cloudfox aws -p cloudfoxable secrets -v2<br></code></pre></td></tr></table></figure><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106163308743.png"></p><p>可以看到其中有一行，描述的是我们需要的flag</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106163432199.png"></p><p>而工具运行的输出如下</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106163608265.png"></p><p>其中loot命令已经输出到指定文件中，</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106163715709.png"></p><p>这条命令就是用来获取flag的命令，profile变量换成使用的ctf-starting-user的凭证，该用户拥有对its-a-secret的ssm::getparameter权限，可以读取flag的内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">aws --profile cloudfoxable --region us-west-2 ssm get-parameter --with-decryption --name /cloudfoxable/flag/its-a-secret<br></code></pre></td></tr></table></figure><p>得到输出：</p><p><img src="/../posts_img/It's%20a%20secret.assets/image-20250106164142614.png"></p><p>在网上找到了更详细的一个不使用cloudfox工具只使用aws cli的版本：</p><p><a href="https://medium.com/@cybersecshashi/cloudfoxable-its-a-secret-63a72cbe83f9">https://medium.com/@cybersecshashi/cloudfoxable-its-a-secret-63a72cbe83f9</a></p><p>记录一下这篇博客所使用的aws命令，之后最好不要借助cloudfox</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">aws iam list-attached-user-policies --user-name ctf-starting-user --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">列出绑定到用户ctf-starting-user的policy，这一步我使用aws console直接查看</span><br><br>aws iam get-policy --policy-arn arn:aws:iam::aws:policy/SecurityAudit --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看策略SecurityAudit的信息。根据输出结果描述：“Based on the description, the managed policy</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">grants the user <span class="hljs-built_in">read</span> access to several AWS services, including IAM. This explains why the</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">“aws iam” <span class="hljs-built_in">command</span> was successful”</span><br><br>aws iam get-policy-version --policy-arn arn:aws:iam::aws:policy/SecurityAudit --version-id v39 --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">可以使用这条命令来查看策略具体的权限， “we can see that this policy allows Get*, Describe*, and List* on lots of services”</span><br><br>aws iam get-policy --policy-arn arn:aws:iam::425670648728:policy/its-a-secret-policy --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看its-a-secret-policy的内容</span><br><br>aws iam get-policy-version --policy-arn arn:aws:iam::425670648728:policy/its-a-secret-policy --version-id v1 --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看具体权限内容，运行就会发现，这条策略是允许对flag执行ssm::getparameter操作</span><br><br>aws ssm get-parameter --name /cloudfoxable/flag/its-a-secret  --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">使用对flag的getparameter权限，会得到加密后的flag</span><br><br>aws ssm get-parameter --name /cloudfoxable/flag/its-a-secret  --with-decryption --profile cloudfoxable<br><span class="hljs-meta prompt_">#</span><span class="language-bash">只需要添加--with-decryption即可解密内容</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>蠢</title>
    <link href="/2025/01/06/%E8%AE%B0%E5%BD%95%E8%A0%A2%E4%BA%8B%E4%B8%89%E5%9B%9B%E6%A1%A9/"/>
    <url>/2025/01/06/%E8%AE%B0%E5%BD%95%E8%A0%A2%E4%BA%8B%E4%B8%89%E5%9B%9B%E6%A1%A9/</url>
    
    <content type="html"><![CDATA[<h1 id="记录蠢事三四桩"><a href="#记录蠢事三四桩" class="headerlink" title="记录蠢事三四桩"></a>记录蠢事三四桩</h1><p><em><strong>1</strong></em></p><p>做ctf题的时候，terraform输出了key id和key，其中id是直接明文输出的，而key的值使用“<sensitive>”做了一个屏蔽，有人竟然把“sensitive”当成了密钥的值往配置文件里面填，因此卡了好久。</p><p><em><strong>2</strong></em></p><p>还是做ctf题的时候，还是进行profile配置，需要先assume一个role，题目中给出了需要配置的内容，其中有一行是“arn:aws:iam::&#x3D;&#x3D;ACCOUNT_ID&#x3D;&#x3D;:role”，有人蠢到看都不看直接往配置文件里复制粘贴啊，结果一直提示没有权限，因此浪费了大半天时间。</p><p>蠢到批爆，上面这两件事在没解决的时候还想着去discord问问作者，幸亏没去丢人现眼。</p><p><em><strong>3</strong></em></p><p>配置wsl里面的Jupyter notebook，安装完了运行不跳浏览器，也不输出访问链接。好嘛一顿查，一查一两个小时，卸载重装，环境都删了重新弄。结果最后是有人无视jupyter notebook提出的警告，说不要建议root用户运行。一直装作看不见，那就一直卡在这儿吧：）</p><p><em><strong>4</strong></em></p><p>寻找shelby count的供电供水数据集，浪费两天时间也没找到，最后放弃了到incore平台上打算先学学仿真怎么用最后找到了数据集。算了这领域咱也不熟悉，一下两下找不到也正常。有人大放厥词，写这论文的是sb——反转了，说这话的是sb。</p><p>ai，怎么有人这么蠢，怎么有人这么菜，怎么有人不长眼啊。</p><p><img src="/../posts_img/%E8%AE%B0%E5%BD%95%E8%A0%A2%E4%BA%8B%E4%B8%89%E5%9B%9B%E6%A1%A9.assets/%252Fi-1736173053429-3.jpg" alt="%2Fi"></p><p>吐了，好恶心。</p><p>真的好恶心…</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
